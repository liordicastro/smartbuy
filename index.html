<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBuy | ××”×™×¨×•×ª , ×©×™×¨×•×ª , ×××™× ×•×ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    
    <style>
        body { font-family: 'Assistant', sans-serif; top: 0px !important; }
        .goog-te-gadget-simple { 
            background-color: #131921 !important; border: 1px solid #FFD814 !important; 
            padding: 6px 12px !important; border-radius: 20px !important; 
            display: flex; align-items: center; justify-content: center;
        }
        .goog-te-gadget-simple span { color: #FFD814 !important; font-weight: bold; font-family: 'Assistant', sans-serif; font-size: 14px !important;}
        .goog-te-gadget-icon { display: none; } 
        .goog-te-banner-frame.skiptranslate { display: none !important; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        
        /* ×¢×™×¦×•×‘ ×¡×œ×™×™×“×¨ ×”××—×™×¨ */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #FFD814; cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #374151; border-radius: 2px; }
    </style>
</head>
<body class="bg-gray-50 text-right overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const firebaseConfig = {
            apiKey: "AIzaSyCndeeXqbALJ93XChyAybvN1PWtbqNZJ4M",
            authDomain: "smartbuy-b4390.firebaseapp.com",
            projectId: "smartbuy-b4390",
            storageBucket: "smartbuy-b4390.firebasestorage.app",
            appId: "1:301016485157:web:9f291f6da715d9ab7cdecc"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ==========================================
        // ××•×“××œ ×§×•×¤×” (Checkout)
        // ==========================================
        const CheckoutModal = ({ cart, total, onClose, onClearCart }) => {
            const [formData, setFormData] = React.useState({ name: '', phone: '', city: '', address: '', notes: '' });
            const [isSubmitting, setIsSubmitting] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);

                try {
                    // 1. ×©××™×¨×ª ×”×”×–×× ×” ×‘××¡×“ ×”× ×ª×•× ×™× ×‘×¤×™×™×¨×‘×™×™×¡
                    await db.collection("orders").add({
                        customer: formData,
                        items: cart,
                        totalAmount: total,
                        status: '×—×“×©',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // 2. ×™×¦×™×¨×ª ×”×•×“×¢×ª ×•×•×˜×¡××¤ ××¡×•×“×¨×ª
                    let waText = `*×”×–×× ×” ×—×“×©×” ×-SmartBuy!* ğŸ›’%0A%0A`;
                    waText += `*×¤×¨×˜×™ ×œ×§×•×—:*%0AğŸ‘¤ ×©×: ${formData.name}%0AğŸ“± ×˜×œ×¤×•×Ÿ: ${formData.phone}%0AğŸ“ ×¢×™×¨: ${formData.city}%0AğŸ  ×›×ª×•×‘×ª: ${formData.address}%0A%0A`;
                    waText += `*×¤×™×¨×•×˜ ××•×¦×¨×™×:*%0A`;
                    cart.forEach(item => { waText += `â–«ï¸ ${item.name} (â‚ª${item.sellingPrice})%0A`; });
                    waText += `%0A*×¡×š ×”×›×œ ×œ×ª×©×œ×•×:* â‚ª${total}%0A`;
                    if(formData.notes) waText += `%0A*×”×¢×¨×•×ª:* ${formData.notes}`;

                    // 3. ××™×¤×•×¡ ×•××¢×‘×¨ ×œ×•×•×˜×¡××¤
                    onClearCart();
                    onClose();
                    window.open(`https://wa.me/972544914204?text=${waText}`, '_blank');

                } catch (error) {
                    console.error("×©×’×™××” ×‘×©××™×¨×ª ×”×”×–×× ×”:", error);
                    alert("××™×¨×¢×” ×©×’×™××”. ×× × × ×¡×” ×©×•×‘ ××• ×¤× ×” ××œ×™× ×• ×‘×•×•×˜×¡××¤.");
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 z-[300] flex items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white rounded-3xl max-w-3xl w-full max-h-[95vh] overflow-y-auto p-0 relative shadow-2xl flex flex-col md:flex-row" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 left-4 text-gray-400 hover:text-black text-2xl font-bold z-10">&times;</button>
                        
                        {/* ×¡×™×›×•× ×”×–×× ×” (×¦×“ ×™××™×Ÿ/×¢×œ×™×•×Ÿ) */}
                        <div className="bg-gray-50 p-8 md:w-5/12 border-b md:border-b-0 md:border-l border-gray-200">
                            <h3 className="text-xl font-black text-gray-900 mb-6">×¡×™×›×•× ×”×–×× ×”</h3>
                            <div className="space-y-4 mb-6 max-h-48 overflow-y-auto pr-2">
                                {cart.map((item, idx) => (
                                    <div key={idx} className="flex items-center gap-3 text-sm">
                                        <img src={item.image} className="w-10 h-10 object-contain bg-white rounded border p-1" />
                                        <div className="flex-grow leading-tight line-clamp-2">{item.name}</div>
                                        <div className="font-bold">â‚ª{item.sellingPrice}</div>
                                    </div>
                                ))}
                            </div>
                            <div className="border-t border-gray-300 pt-4 flex justify-between items-center">
                                <span className="font-bold text-gray-600">×¡×š ×”×›×œ:</span>
                                <span className="text-3xl font-black text-red-600">â‚ª{total}</span>
                            </div>
                        </div>

                        {/* ×˜×•×¤×¡ ×¤×¨×˜×™× ××™×©×™×™× (×¦×“ ×©×××œ) */}
                        <div className="p-8 md:w-7/12">
                            <h2 className="text-2xl font-extrabold text-gray-900 mb-6">×¤×¨×˜×™ ××©×œ×•×— ×•×ª×©×œ×•×</h2>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <input required type="text" placeholder="×©× ××œ×" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-[#FFD814]" value={formData.name} onChange={e=>setFormData({...formData, name: e.target.value})} />
                                    <input required type="tel" placeholder="×˜×œ×¤×•×Ÿ × ×™×™×“" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-[#FFD814]" value={formData.phone} onChange={e=>setFormData({...formData, phone: e.target.value})} />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <input required type="text" placeholder="×¢×™×¨ / ×™×™×©×•×‘" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-[#FFD814]" value={formData.city} onChange={e=>setFormData({...formData, city: e.target.value})} />
                                    <input required type="text" placeholder="×¨×—×•×‘ ×•××¡×¤×¨ ×‘×™×ª" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-[#FFD814]" value={formData.address} onChange={e=>setFormData({...formData, address: e.target.value})} />
                                </div>
                                <textarea placeholder="×”×¢×¨×•×ª ×œ×”×–×× ×” (××•×¤×¦×™×•× ×œ×™)" rows="2" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:border-[#FFD814]" value={formData.notes} onChange={e=>setFormData({...formData, notes: e.target.value})}></textarea>
                                
                                <div className="bg-yellow-50 text-yellow-800 p-4 rounded-xl text-xs font-bold my-4 flex gap-3">
                                    <i className="fa-solid fa-shield-halved text-xl"></i>
                                    ×œ×—×™×¦×” ×¢×œ ×¡×™×•× ×ª×¢×‘×™×¨ ××ª ×”×”×–×× ×” ×œ× ×¦×™×’ ×‘×•×•××˜×¡××¤ ×œ×”×©×œ××ª ×ª×©×œ×•× ×××•×‘×˜×— ×•×ª×™××•× ××©×œ×•×— ××¨×¦×™.
                                </div>

                                <button disabled={isSubmitting} type="submit" className="w-full bg-[#131921] hover:bg-black text-white font-extrabold py-4 rounded-xl transition-all text-lg flex items-center justify-center gap-2">
                                    {isSubmitting ? "×©×•×œ×— ×”×–×× ×”..." : <>×¡×™×•× ×•×©×œ×™×—×ª ×”×–×× ×” <i className="fa-brands fa-whatsapp text-[#25D366] text-xl"></i></>}
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // ××•×“××œ ×”×ª×—×‘×¨×•×ª (Auth)
        // ==========================================
        const AuthModal = ({ onClose }) => {
            const [phone, setPhone] = React.useState("");
            const [code, setCode] = React.useState("");
            const [step, setStep] = React.useState(1);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState("");

            React.useEffect(() => {
                if (!window.recaptchaVerifier) {
                    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });
                }
            }, []);

            const handleGoogleLogin = async () => {
                try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); onClose(); } 
                catch (err) { setError("×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª ×¢× ×’×•×’×œ."); }
            };

            const sendSms = async () => {
                setLoading(true); setError("");
                try {
                    const phoneE164 = phone.startsWith("0") ? "+972" + phone.slice(1) : phone;
                    window.confirmationResult = await auth.signInWithPhoneNumber(phoneE164, window.recaptchaVerifier);
                    setStep(2);
                } catch (err) { setError("×©×’×™××” ×‘×©×œ×™×—×ª ×”×¡××¡. ×•×“× ×©×”××¡×¤×¨ ×ª×§×™×Ÿ."); }
                setLoading(false);
            };

            const verifyCode = async () => {
                setLoading(true); setError("");
                try { await window.confirmationResult.confirm(code); onClose(); } 
                catch (err) { setError("×§×•×“ ×©×’×•×™, × ×¡×” ×©×•×‘."); }
                setLoading(false);
            };

            return (
                <div className="fixed inset-0 bg-black/80 z-[200] flex items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white rounded-3xl max-w-sm w-full p-8 relative shadow-2xl text-center" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 left-4 text-gray-400 hover:text-black text-2xl font-bold">&times;</button>
                        <div className="text-4xl text-[#FFD814] mb-4"><i className="fa-solid fa-crown"></i></div>
                        <h2 className="text-2xl font-black text-gray-900 mb-2">××•×¢×“×•×Ÿ SmartBuy</h2>
                        <p className="text-gray-500 text-sm mb-6">×”×ª×—×‘×¨ ×›×“×™ ×œ×©××•×¨ ××ª ×”×¢×’×œ×” ×•×œ×¦×‘×•×¨ ×”×˜×‘×•×ª</p>
                        {error && <div className="bg-red-100 text-red-600 p-2 rounded-lg text-xs mb-4 font-bold">{error}</div>}
                        {step === 1 ? (
                            <div>
                                <button onClick={handleGoogleLogin} className="w-full bg-white border-2 border-gray-200 hover:bg-gray-50 text-gray-800 font-bold py-3 rounded-xl flex items-center justify-center gap-3 mb-4 transition-colors">
                                    <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" className="w-5 h-5" /> ×”××©×š ×¢× Google
                                </button>
                                <div className="flex items-center gap-3 my-4"><div className="h-px bg-gray-200 flex-grow"></div><span className="text-gray-400 text-xs">××• ×‘×××¦×¢×•×ª × ×™×™×“</span><div className="h-px bg-gray-200 flex-grow"></div></div>
                                <input type="tel" dir="ltr" placeholder="050-0000000" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 mb-4 text-center font-bold focus:outline-none focus:border-[#FFD814]" value={phone} onChange={e => setPhone(e.target.value)} />
                                <button onClick={sendSms} disabled={loading || phone.length < 9} className="w-full bg-[#131921] hover:bg-black text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50">{loading ? "×©×•×œ×—..." : "×©×œ×— ×§×•×“ ×‘-SMS"}</button>
                            </div>
                        ) : (
                            <div>
                                <p className="text-sm font-bold mb-4 text-gray-700">×”×–×Ÿ ××ª ×”×§×•×“ ×©× ×©×œ×— ×œ× ×™×™×“ ×©×œ×š</p>
                                <input type="text" dir="ltr" placeholder="123456" maxLength="6" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 mb-4 text-center font-bold tracking-[1em] focus:outline-none focus:border-[#FFD814]" value={code} onChange={e => setCode(e.target.value)} />
                                <button onClick={verifyCode} disabled={loading || code.length < 6} className="w-full bg-[#FFD814] hover:bg-[#F7CA00] text-black font-extrabold py-3 rounded-xl transition-colors disabled:opacity-50">{loading ? "×‘×•×“×§..." : "×××ª ×•×”×ª×—×‘×¨"}</button>
                                <button onClick={() => setStep(1)} className="mt-4 text-xs text-gray-500 hover:text-black underline">×—×–×•×¨ ××—×•×¨×”</button>
                            </div>
                        )}
                        <div id="recaptcha-container"></div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // ××•×“××œ ××•×¦×¨ ××•×¨×—×‘ (×›×¨×˜×™×¡ ××•×¦×¨)
        // ==========================================
        const ProductModal = ({ product, onClose, onAddToCart }) => (
            <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                <div className="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-8 relative shadow-2xl" onClick={e => e.stopPropagation()}>
                    <button onClick={onClose} className="absolute top-6 left-6 text-gray-400 hover:text-black text-2xl font-bold">&times;</button>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div className="flex items-center justify-center p-6 bg-gray-50 rounded-2xl">
                            <img src={product.image} className="max-h-96 object-contain" alt={product.name} />
                        </div>
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 uppercase tracking-widest">{product.category} | ×“×’×: {product.model}</div>
                            <h2 className="text-2xl font-extrabold text-gray-900 mb-4 leading-tight">{product.name}</h2>
                            <p className="text-gray-600 mb-8 leading-relaxed text-sm">{product.description}</p>
                            <div className="border-t border-gray-100 pt-6 mb-8">
                                <div className="text-sm text-gray-500 mb-1">××—×™×¨ SmartBuy (×¤×¨×™×¡×” ××¨×¦×™×ª):</div>
                                <div className="text-5xl font-black text-gray-900 mb-1">â‚ª{product.sellingPrice}</div>
                                <div className="text-xs text-gray-400 line-through">××—×™×¨ ×©×•×§: â‚ª{Math.round(product.sellingPrice * 1.15)}</div>
                            </div>
                            <button onClick={() => { onAddToCart(product); onClose(); }} className="w-full bg-[#FFD814] hover:bg-[#F7CA00] text-black font-extrabold py-5 rounded-2xl transition-all text-lg active:scale-95 shadow-md">
                                <i className="fa-solid fa-cart-plus ml-2"></i> ×”×•×¡×¤×” ×œ×¡×œ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        );

        // ==========================================
        // ×›×¨×˜×™×¡ ××•×¦×¨ ×¨×’×™×œ ×œ××¡×š ×”×¨××©×™
        // ==========================================
        const ProductCard = ({ product, onOpenDetails, onAddToCart }) => (
            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col h-full group hover:shadow-2xl transition-all duration-500 overflow-hidden">
                <div className="relative h-60 p-6 flex items-center justify-center overflow-hidden cursor-pointer" onClick={() => onOpenDetails(product)}>
                    <img src={product.image} className="max-h-full max-w-full object-contain group-hover:scale-110 transition-transform duration-700" alt={product.name} />
                    <div className="absolute top-3 right-3 bg-black text-[#FFD814] text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-tighter shadow-md">Premium</div>
                </div>
                <div className="p-5 flex-grow border-t border-gray-50">
                    <h3 className="text-sm font-bold text-gray-900 mb-1 leading-tight h-10 overflow-hidden cursor-pointer hover:text-[#FFD814] transition-colors" onClick={() => onOpenDetails(product)}>{product.name}</h3>
                    <p className="text-gray-500 text-[11px] line-clamp-2 mb-3 italic">{product.description}</p>
                    <div className="flex justify-between items-end pt-2">
                        <div className="text-2xl font-black text-gray-900">â‚ª{product.sellingPrice}</div>
                        <div className="text-xs text-gray-400 line-through mb-1">â‚ª{Math.round(product.sellingPrice * 1.15)}</div>
                    </div>
                </div>
                <div className="grid grid-cols-2 gap-2 p-3 bg-gray-50">
                    <button onClick={() => onOpenDetails(product)} className="bg-white border border-gray-200 hover:bg-gray-100 text-gray-700 font-bold py-2.5 rounded-xl transition-all text-xs shadow-sm">×›×¨×˜×™×¡ ××•×¦×¨</button>
                    <button onClick={() => onAddToCart(product)} className="bg-[#FFD814] hover:bg-[#F7CA00] text-black font-extrabold py-2.5 rounded-xl transition-all text-xs shadow-sm active:scale-95">×”×•×¡×¤×” ×œ×¡×œ</button>
                </div>
            </div>
        );

        // ==========================================
        // ×”××¤×œ×™×§×¦×™×” ×”×¨××©×™×ª (App)
        // ==========================================
        const App = () => {
            const [products, setProducts] = React.useState([]);
            const [filter, setFilter] = React.useState("All");
            const [searchQuery, setSearchQuery] = React.useState("");
            const [maxPrice, setMaxPrice] = React.useState(15000); // ×¡×˜×™×™×˜ ×œ×¡×œ×™×™×“×¨ ×”××—×™×¨
            const [loading, setLoading] = React.useState(true);
            const [selectedProduct, setSelectedProduct] = React.useState(null);
            
            const [cart, setCart] = React.useState([]);
            const [isCartOpen, setIsCartOpen] = React.useState(false);
            const [isAuthOpen, setIsAuthOpen] = React.useState(false);
            const [isCheckoutOpen, setIsCheckoutOpen] = React.useState(false); // ×¡×˜×™×™×˜ ×œ×§×•×¤×”
            const [user, setUser] = React.useState(null);

            React.useEffect(() => {
                const unsubProducts = db.collection("products").onSnapshot(s => {
                    const loadedProducts = s.docs.map(d => ({id: d.id, ...d.data()}));
                    setProducts(loadedProducts);
                    // ×¢×“×›×•×Ÿ ×’×‘×•×œ ×”×¡×œ×™×™×“×¨ ×œ×¤×™ ×”××•×¦×¨ ×”×™×§×¨ ×‘×™×•×ª×¨
                    if(loadedProducts.length > 0) {
                        const highest = Math.max(...loadedProducts.map(p => p.sellingPrice));
                        setMaxPrice(Math.ceil(highest / 1000) * 1000);
                    }
                    setLoading(false);
                });

                const unsubAuth = auth.onAuthStateChanged(async (currentUser) => {
                    if (currentUser) {
                        const userRef = db.collection("users").doc(currentUser.uid);
                        const doc = await userRef.get();
                        if (!doc.exists) {
                            await userRef.set({
                                name: currentUser.displayName || '×œ×§×•×— ×™×§×¨',
                                phone: currentUser.phoneNumber || null,
                                email: currentUser.email || null,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        setUser({ uid: currentUser.uid, name: currentUser.displayName || currentUser.phoneNumber || '×—×‘×¨ ××•×¢×“×•×Ÿ' });
                    } else { setUser(null); }
                });

                return () => { unsubProducts(); unsubAuth(); };
            }, []);

            const addToCart = (product) => { setCart([...cart, product]); setIsCartOpen(true); };
            const removeFromCart = (index) => setCart(cart.filter((_, i) => i !== index));
            const clearCart = () => setCart([]);
            const cartTotal = cart.reduce((sum, item) => sum + item.sellingPrice, 0);

            const categoryMap = { 
                "All": "×”×›×œ", "Fridges": "××§×¨×¨×™×", "Freezers": "××§×¤×™××™×", "AC": "××–×’× ×™×", 
                "Washing": "×›×‘×™×¡×”", "Dryers": "××™×™×‘×©×™×", "Dishwashers": "××“×™×—×™×",
                "Ovens": "×ª× ×•×¨×™×", "Hobs": "×›×™×¨×™×™×", "TV": "×˜×œ×•×•×™×–×™×•×ª", "Blenders": "××™×§×¡×¨×™× ×•×‘×œ× ×“×¨×™×"
            };

            const getCategoryImage = (catKey) => {
                if(catKey === "All") return "https://cdn-icons-png.flaticon.com/512/3514/3514491.png";
                const productInCat = products.find(p => p.category === catKey);
                return productInCat ? productInCat.image : "https://cdn-icons-png.flaticon.com/512/1174/1174463.png";
            };

            // ×¡×™× ×•×Ÿ ××©×•×œ×‘: ×§×˜×’×•×¨×™×” + ×—×™×¤×•×© ×—×•×¤×©×™ + ×ª×§×¦×™×‘
            const filteredProducts = products.filter(p => {
                const matchCategory = filter === "All" || p.category === filter;
                const matchSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase()) || (p.model && p.model.toLowerCase().includes(searchQuery.toLowerCase()));
                const matchPrice = p.sellingPrice <= maxPrice;
                return matchCategory && matchSearch && matchPrice;
            });

            return (
                <div className="min-h-screen pb-20 relative">
                    {/* ×—×œ×•× ×•×ª ×¦×¤×™× (Modals) */}
                    {selectedProduct && <ProductModal product={selectedProduct} onClose={() => setSelectedProduct(null)} onAddToCart={addToCart} />}
                    {isAuthOpen && <AuthModal onClose={() => setIsAuthOpen(false)} />}
                    {isCheckoutOpen && <CheckoutModal cart={cart} total={cartTotal} onClose={() => setIsCheckoutOpen(false)} onClearCart={clearCart} />}

                    {/* ××’×™×¨×ª ×¡×œ ×§× ×™×•×ª */}
                    <div className={`fixed top-0 left-0 h-full w-80 bg-white shadow-[10px_0_30px_rgba(0,0,0,0.2)] z-[200] transform transition-transform duration-300 flex flex-col ${isCartOpen ? "translate-x-0" : "-translate-x-full"}`}>
                        <div className="bg-[#131921] text-white p-5 flex justify-between items-center">
                            <h2 className="text-xl font-bold"><i className="fa-solid fa-cart-shopping ml-2 text-[#FFD814]"></i>×¡×œ ×”×§× ×™×•×ª ×©×œ×™</h2>
                            <button onClick={() => setIsCartOpen(false)} className="text-gray-400 hover:text-white text-2xl">&times;</button>
                        </div>
                        <div className="flex-grow overflow-y-auto p-4 bg-gray-50">
                            {cart.length === 0 ? (
                                <div className="text-center text-gray-400 mt-20">
                                    <i className="fa-solid fa-basket-shopping text-6xl mb-4 opacity-20"></i>
                                    <p>×”×¡×œ ×©×œ×š ×¨×™×§ ×›×¨×’×¢</p>
                                </div>
                            ) : (
                                cart.map((item, index) => (
                                    <div key={index} className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center gap-3 relative">
                                        <button onClick={() => removeFromCart(index)} className="absolute top-2 left-2 text-red-400 hover:text-red-600 bg-red-50 w-6 h-6 rounded-full flex items-center justify-center transition-colors"><i className="fa-solid fa-trash text-xs"></i></button>
                                        <img src={item.image} className="w-16 h-16 object-contain bg-gray-50 rounded-lg p-1" />
                                        <div className="flex-grow pl-6">
                                            <h4 className="text-xs font-bold text-gray-800 line-clamp-2 leading-tight">{item.name}</h4>
                                            <div className="text-sm font-black text-gray-900 mt-1">â‚ª{item.sellingPrice}</div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                        <div className="p-5 bg-white border-t border-gray-200 shadow-[0_-10px_20px_rgba(0,0,0,0.05)]">
                            <div className="flex justify-between items-center mb-4">
                                <span className="text-gray-600 font-bold">×¡×š ×”×›×œ:</span>
                                <span className="text-3xl font-black text-gray-900">â‚ª{cartTotal}</span>
                            </div>
                            <button onClick={() => { if(cart.length > 0){ setIsCartOpen(false); setIsCheckoutOpen(true); } }} className={`w-full font-extrabold py-4 rounded-xl transition-all shadow-md ${cart.length > 0 ? "bg-[#FFD814] hover:bg-[#F7CA00] text-black active:scale-95" : "bg-gray-200 text-gray-400 cursor-not-allowed"}`}>
                                ×”××©×š ×œ×ª×©×œ×•× ×‘×§×•×¤×” <i className="fa-solid fa-arrow-left ml-1"></i>
                            </button>
                        </div>
                    </div>

                    {isCartOpen && <div className="fixed inset-0 bg-black/50 z-[190] backdrop-blur-sm transition-opacity" onClick={() => setIsCartOpen(false)}></div>}

                    {/* ×¡×¨×’×œ ×¢×œ×™×•×Ÿ ×¨××©×™ */}
                    <header className="bg-[#131921] text-white sticky top-0 z-40 border-b-4 border-[#FFD814] shadow-xl">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                            
                            <div className="flex items-center gap-6 w-full md:w-auto justify-between md:justify-start">
                                <div>
                                    <div className="text-4xl font-black italic tracking-tighter text-[#FFD814] cursor-pointer" onClick={()=> {setFilter("All"); setSearchQuery("");}}>SMART<span className="text-white">BUY</span></div>
                                    <div className="text-[10px] font-bold text-gray-400 tracking-widest mt-1">××”×™×¨×•×ª â€¢ ×©×™×¨×•×ª â€¢ ×××™× ×•×ª</div>
                                </div>
                                <div id="google_translate_element" className="hidden sm:block"></div>
                            </div>

                            {/* ××–×•×¨ ×—×™×¤×•×© ×•×¡×œ×™×™×“×¨ ×ª×§×¦×™×‘ ××ª×—×ª×™×• */}
                            <div className="flex-grow max-w-2xl w-full flex flex-col gap-3">
                                <div className="flex bg-white rounded-xl overflow-hidden focus-within:ring-2 ring-[#FFD814] transition-shadow shadow-inner">
                                    <input 
                                        type="text" 
                                        placeholder="×—×¤×© ××§×¨×¨, ××¡×š, ×ª× ×•×¨ ××• ×›×œ ××•×¦×¨ ×¤×¨×™××™×•×..." 
                                        className="w-full py-3 px-5 text-gray-800 focus:outline-none text-sm font-medium placeholder-gray-400"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                    <button className="bg-[#FFD814] hover:bg-[#F7CA00] px-6 text-black transition-colors">
                                        <i className="fa-solid fa-magnifying-glass text-lg"></i>
                                    </button>
                                </div>
                                
                                {/* ×¡×œ×™×™×“×¨ ×ª×§×¦×™×‘ (Price Slider) */}
                                <div className="flex items-center gap-4 bg-white/5 p-2 rounded-lg border border-gray-700">
                                    <span className="text-xs font-bold text-gray-300 whitespace-nowrap"><i className="fa-solid fa-wallet text-[#FFD814] ml-1"></i> ×ª×§×¦×™×‘ ×¢×“: â‚ª{maxPrice}</span>
                                    <input 
                                        type="range" 
                                        min="0" max="15000" step="100" 
                                        value={maxPrice} 
                                        onChange={(e) => setMaxPrice(Number(e.target.value))} 
                                        className="w-full" 
                                    />
                                </div>
                            </div>

                            <div className="flex items-center gap-3 w-full md:w-auto justify-end">
                                {user ? (
                                    <div className="flex flex-col items-center justify-center p-2 rounded-xl text-[#FFD814] group cursor-pointer relative">
                                        <i className="fa-solid fa-user-check text-xl mb-1"></i>
                                        <span className="text-[10px] font-bold whitespace-nowrap max-w-[80px] overflow-hidden text-ellipsis dir-ltr">{user.name}</span>
                                        <button onClick={() => auth.signOut()} className="absolute top-10 bg-white text-black text-xs font-bold px-3 py-1 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity">×”×ª× ×ª×§</button>
                                    </div>
                                ) : (
                                    <button onClick={() => setIsAuthOpen(true)} className="flex flex-col items-center justify-center p-2 rounded-xl hover:bg-white/10 transition-colors text-white group">
                                        <i className="fa-regular fa-user text-xl mb-1 group-hover:text-[#FFD814] transition-colors"></i>
                                        <span className="text-[10px] font-bold whitespace-nowrap">××•×¨×— / ×—×‘×¨</span>
                                    </button>
                                )}
                                
                                <div className="h-8 w-px bg-gray-600 mx-1"></div>

                                <button onClick={() => setIsCartOpen(true)} className="flex items-center bg-white/10 hover:bg-white/20 p-2 pr-4 rounded-xl transition-colors relative group border border-transparent hover:border-[#FFD814]/30">
                                    <div className="text-right mr-3 hidden sm:block">
                                        <div className="text-[10px] text-gray-400">×¡×œ ×§× ×™×•×ª</div>
                                        <div className="text-sm font-bold text-[#FFD814]">â‚ª{cartTotal}</div>
                                    </div>
                                    <div className="relative">
                                        <i className="fa-solid fa-cart-shopping text-2xl group-hover:text-[#FFD814] transition-colors"></i>
                                        {cart.length > 0 && (
                                            <span className="absolute -top-2 -right-3 bg-[#FFD814] text-black text-xs font-black w-5 h-5 flex items-center justify-center rounded-full shadow-lg border-2 border-[#131921]">
                                                {cart.length}
                                            </span>
                                        )}
                                    </div>
                                </button>
                            </div>
                        </div>
                    </header>

                    <nav className="bg-white shadow-sm py-5 sticky top-[138px] md:top-[128px] z-30 overflow-x-auto hide-scroll px-6 border-b border-gray-200">
                        <div className="max-w-7xl mx-auto flex gap-4 md:justify-center min-w-max">
                            {Object.keys(categoryMap).map(cat => (
                                <button key={cat} onClick={() => { setFilter(cat); setMaxPrice(15000); }} className={`flex flex-col items-center justify-center min-w-[80px] p-2 rounded-2xl transition-all duration-300 border-2 ${filter === cat ? "border-[#FFD814] bg-yellow-50 shadow-md scale-105" : "border-transparent hover:bg-gray-100"}`}>
                                    <div className="w-12 h-12 flex items-center justify-center bg-white rounded-full shadow-sm mb-2 p-2">
                                        <img src={getCategoryImage(cat)} alt={categoryMap[cat]} className="max-h-full max-w-full object-contain" />
                                    </div>
                                    <span className={`text-[11px] font-bold ${filter === cat ? "text-black" : "text-gray-600"}`}>{categoryMap[cat]}</span>
                                </button>
                            ))}
                        </div>
                    </nav>

                    <main className="max-w-7xl mx-auto px-6 py-10">
                        {loading ? (
                            <div className="flex flex-col items-center justify-center py-40">
                                <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-[#FFD814] mb-4"></div>
                                <div className="text-gray-500 font-bold">××¢×“×›×Ÿ ××œ××™ ×‘×¤×¨×™×¡×” ××¨×¦×™×ª...</div>
                            </div>
                        ) : filteredProducts.length > 0 ? (
                            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                                {filteredProducts.map(p => <ProductCard key={p.id} product={p} onOpenDetails={setSelectedProduct} onAddToCart={addToCart} />)}
                            </div>
                        ) : (
                            <div className="col-span-full text-center p-20 bg-white rounded-3xl shadow-sm border border-dashed border-gray-300">
                                <i className="fa-solid fa-magnifying-glass text-6xl text-gray-200 mb-4"></i>
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">×œ× ××¦×× ×• ××•×¦×¨×™× ××ª××™××™×</h3>
                                <p className="text-gray-500">× ×¡×” ×œ×”×’×“×™×œ ××ª ×”×ª×§×¦×™×‘ ××• ×œ×—×¤×© ××™×œ×” ××—×¨×ª</p>
                            </div>
                        )}
                    </main>

                    <footer className="bg-[#131921] text-gray-300 mt-20 border-t-8 border-gray-800">
                        <div className="max-w-7xl mx-auto px-6 py-16 grid grid-cols-1 md:grid-cols-4 gap-12 text-sm">
                            <div>
                                <div className="text-3xl font-black italic text-[#FFD814] mb-4">SMART<span className="text-white">BUY</span></div>
                                <p className="text-xs leading-relaxed text-gray-400">×”×—× ×•×ª ×”××•×‘×™×œ×” ×œ××›×©×™×¨×™ ×—×©××œ ×‘×¤×¨×™×¡×” ××¨×¦×™×ª. ×× ×• ××ª×—×™×™×‘×™× ×œ××™×›×•×ª ×œ×œ× ×¤×©×¨×•×ª, ××©×œ×•×— ××”×™×¨, ×©×™×¨×•×ª ××§×¦×•×¢×™, ×•××—×™×¨×™× ×©×•×‘×¨×™ ×©×•×§. ×§× ×™×” ×—×›××” ××ª×—×™×œ×” ×›××Ÿ.</p>
                            </div>
                            <div>
                                <h4 className="font-bold text-white mb-4 border-b border-gray-700 pb-2">×©×™×¨×•×ª ×œ×§×•×—×•×ª</h4>
                                <ul className="space-y-3 text-xs">
                                    <li><i className="fa-solid fa-phone text-[#FFD814] ml-2"></i> ××•×§×“ ×”×–×× ×•×ª: <a href="tel:0544914204" className="dir-ltr inline-block hover:text-white font-bold">054-4914204</a></li>
                                    <li><i className="fa-solid fa-envelope text-[#FFD814] ml-2"></i> ×“×•×"×œ: <a href="mailto:info@smartbuy.co.il" className="hover:text-white">info@smartbuy.co.il</a></li>
                                    <li><i className="fa-solid fa-clock text-[#FFD814] ml-2"></i> ×©×¢×•×ª ×¤×¢×™×œ×•×ª: ×'-×”' 09:00 - 18:00</li>
                                </ul>
                            </div>
                            <div>
                                <h4 className="font-bold text-white mb-4 border-b border-gray-700 pb-2">××™×“×¢ ×©×™××•×©×™</h4>
                                <ul className="space-y-2 text-xs">
                                    <li><a href="#" className="hover:text-[#FFD814] transition-colors">×ª×§× ×•×Ÿ ×”××ª×¨</a></li>
                                    <li><a href="#" className="hover:text-[#FFD814] transition-colors">××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</a></li>
                                    <li><a href="#" className="hover:text-[#FFD814] transition-colors">××“×™× ×™×•×ª ×”×—×–×¨×•×ª ×•×‘×™×˜×•×œ×™×</a></li>
                                    <li><a href="#" className="hover:text-[#FFD814] transition-colors">×”×¦×”×¨×ª × ×’×™×©×•×ª</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 className="font-bold text-white mb-4 border-b border-gray-700 pb-2">×§× ×™×” ×××•×‘×˜×—×ª</h4>
                                <div className="flex gap-2 mb-4 text-2xl text-gray-500">
                                    <i className="fa-brands fa-cc-visa hover:text-white transition-colors cursor-pointer"></i>
                                    <i className="fa-brands fa-cc-mastercard hover:text-white transition-colors cursor-pointer"></i>
                                    <i className="fa-brands fa-cc-paypal hover:text-white transition-colors cursor-pointer"></i>
                                    <i className="fa-brands fa-cc-apple-pay hover:text-white transition-colors cursor-pointer"></i>
                                </div>
                                <p className="text-[10px] text-gray-500">×”××ª×¨ ×××•×‘×˜×— ×‘×ª×§×Ÿ ×”××—××™×¨ ×‘×™×•×ª×¨ ×œ×¡×œ×™×§×ª ××©×¨××™.</p>
                            </div>
                        </div>
                        <div className="bg-black py-4 px-6 text-center text-[10px] text-gray-500 border-t border-gray-800">
                            &copy; 2026 SmartBuy. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª. ××”×™×¨×•×ª , ×©×™×¨×•×ª , ×××™× ×•×ª. ×¤×¨×™×¡×” ××¨×¦×™×ª ××•×‘×˜×—×ª.
                        </div>
                    </footer>

                    <a href="https://wa.me/972544914204?text=×©×œ×•× SmartBuy, ×”×’×¢×ª×™ ××”××ª×¨ ×•××©××— ×œ×”×ª×™×™×¢×¥ ×œ×’×‘×™ ××•×¦×¨..." target="_blank" className="fixed bottom-6 right-6 bg-[#25D366] p-4 rounded-full shadow-[0_10px_20px_rgba(37,211,102,0.4)] z-[150] hover:scale-110 transition-transform active:scale-95 flex items-center justify-center border-2 border-white">
                        <i className="fa-brands fa-whatsapp text-white text-3xl"></i>
                    </a>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'he', 
                includedLanguages: 'he,en,fr,ru',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE, 
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
</body>
</html>